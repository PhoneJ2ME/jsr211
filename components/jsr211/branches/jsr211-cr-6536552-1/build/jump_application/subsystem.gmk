#
#  
#
# Copyright  1990-2006 Sun Microsystems, Inc. All Rights Reserved.
# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER
# 
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License version
# 2 only, as published by the Free Software Foundation. 
# 
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License version 2 for more details (a copy is
# included at /legal/license.txt). 
# 
# You should have received a copy of the GNU General Public License
# version 2 along with this work; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
# 02110-1301 USA 
# 
# Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa
# Clara, CA 95054 or visit www.sun.com if you need additional
# information or have any questions. 
#
######################################################################
#
# Module's Component Configuration file
#
#####################################################################


JSR_211_BUILD_DIR       = $(JSROP_BUILD_DIR)/jsr211
JSR_211_GENERATED_DIR   = $(JSR_211_BUILD_DIR)/generated


# Project speficic definitions
ifndef PROJECT_JSR_211_DIR
PROJECT_JSR_211_DIR=$(JSR_211_DIR)
endif


JSR_211_SOURCEPATH = \
$(JSR_211_DIR)/src/share/classes$(PATHSEP)$(JSR_211_DIR)/src/jump_application/classes$

JSR_211_PACKAGES = \
   com.sun.j2me.content \
   com.sun.midp.content \
   javax.microedition.content

JAVADOC_ALL_SOURCEPATH += $(JSR_211_SOURCEPATH)
JAVADOC_ALL_PACKAGES +=  $(JSR_211_PACKAGES)

GROUP_DOC_ALL += \
        -group "JSR211 Content Handler API" \
	$(shell echo $(JSR_211_PACKAGES) | tr ' ' $(PATHSEP))


# Directory containing native files
SUBSYSTEM_JSR_211_NATIVE_JUMP_DIR = $(JSR_211_DIR)/src/jump_application/core/native
SUBSYSTEM_JSR_211_NATIVE_JUMP_SHARE_DIR = $(SUBSYSTEM_JSR_211_NATIVE_JUMP_DIR)/share
SUBSYSTEM_JSR_211_NATIVE_JUMP_PLATF_DIR = $(SUBSYSTEM_JSR_211_NATIVE_JUMP_DIR)/javacall

SUBSYSTEM_JSR_211_EXTRA_INCLUDES = $(SUBSYSTEM_JSR_211_NATIVE_JUMP_DIR)/include $(SUBSYSTEM_JSR_211_NATIVE_JUMP_SHARE_DIR)/inc

DOXYGEN_INPUT_LIST += \
    $(SUBSYSTEM_JSR_211_NATIVE_JUMP_DIR)/include/jsr211_registry.h \
    $(SUBSYSTEM_JSR_211_NATIVE_JUMP_DIR)/include/jsr211_invoc.h

# vpath for ( chapi ) subsystem
#
vpath % $(SUBSYSTEM_JSR_211_NATIVE_JUMP_SHARE_DIR)
vpath % $(SUBSYSTEM_JSR_211_NATIVE_JUMP_PLATF_DIR)

# Java files for the ( JSR_211 ) module
#
INTERNAL_JSR_211_DIR   = $(JSR_211_DIR)/src/share/classes
INTERNAL_JSR_211_JUMP_DIR   = $(JSR_211_DIR)/src/jump_application/classes
INTERNAL_JSR_211_SHARE_DIR    = $(JSR_211_DIR)/share/src/classes
INTERNAL_JSR_211_CONFIG_DIR= $(JSR_211_DIR)/build/share

# Obsolete: Include JSR_211 system properties in Configuration
SUBSYSTEM_CONFIGURATION_PROPERTRATOR_ARGS += \
    -f $(INTERNAL_JSR_211_CONFIG_DIR)/properties_chapi.xml

# Include JSR_211 system properties in Configuration
SUBSYSTEM_CONFIGURATION_INPUT_FILES += \
	$(INTERNAL_JSR_211_CONFIG_DIR)/properties_chapi.xml

# Include JSR_211 constants in Configuration
#SUBSYSTEM_CONFIGURATION_CONSTANTRATOR_ARGS += \
#    -content $(INTERNAL_JSR_211_CONFIG_DIR)/constants_chapi.xml


# Implementation of JSR_211
INTERNAL_JSR_211_JAVA_FILES := \
    $(INTERNAL_JSR_211_DIR)/javax/microedition/content/ContentHandlerServer.java \
    $(INTERNAL_JSR_211_DIR)/javax/microedition/content/ContentHandlerException.java \
    $(INTERNAL_JSR_211_DIR)/javax/microedition/content/ActionNameMap.java \
    $(INTERNAL_JSR_211_DIR)/javax/microedition/content/ContentHandlerServerImpl.java \
    $(INTERNAL_JSR_211_DIR)/javax/microedition/content/ContentHandler.java \
    $(INTERNAL_JSR_211_DIR)/javax/microedition/content/Invocation.java \
    $(INTERNAL_JSR_211_DIR)/javax/microedition/content/RequestListener.java \
    $(INTERNAL_JSR_211_DIR)/javax/microedition/content/ResponseListener.java \
    $(INTERNAL_JSR_211_DIR)/javax/microedition/content/Registry.java \
    $(INTERNAL_JSR_211_DIR)/com/sun/j2me/content/ContentHandlerImpl.java \
    $(INTERNAL_JSR_211_DIR)/com/sun/j2me/content/RegistryImpl.java \
    $(INTERNAL_JSR_211_DIR)/com/sun/j2me/content/RequestListenerImpl.java \
    $(INTERNAL_JSR_211_DIR)/com/sun/j2me/content/ResponseListenerImpl.java \
    $(INTERNAL_JSR_211_DIR)/com/sun/j2me/content/InvocationImpl.java \
    $(INTERNAL_JSR_211_DIR)/com/sun/j2me/content/RegistryStore.java \
    $(INTERNAL_JSR_211_JUMP_DIR)/com/sun/j2me/content/InvocationStore.java \
    $(INTERNAL_JSR_211_JUMP_DIR)/com/sun/j2me/content/AppProxy.java 

#INTERNAL_JSR_211_CLASS_FILES := \
#$(subst $(INTERNAL_JSR_211_DIR),$(MIDP_MAKE_DIR)/classes,\
#$(INTERNAL_JSR_211_JAVA_FILES:java=class))

INTERNAL_JSR_211_CLASS_FILES := \
    $(MIDP_MAKE_DIR)/classes/javax/microedition/content/ContentHandlerServer.class \
    $(MIDP_MAKE_DIR)/classes/javax/microedition/content/ContentHandlerException.class \
    $(MIDP_MAKE_DIR)/classes/javax/microedition/content/ActionNameMap.class \
    $(MIDP_MAKE_DIR)/classes/javax/microedition/content/ContentHandlerServerImpl.class \
    $(MIDP_MAKE_DIR)/classes/javax/microedition/content/ContentHandler.class \
    $(MIDP_MAKE_DIR)/classes/javax/microedition/content/Invocation.class \
    $(MIDP_MAKE_DIR)/classes/javax/microedition/content/RequestListener.class \
    $(MIDP_MAKE_DIR)/classes/javax/microedition/content/ResponseListener.class \
    $(MIDP_MAKE_DIR)/classes/javax/microedition/content/Registry.class \
    $(MIDP_MAKE_DIR)/classes/com/sun/j2me/content/ContentHandlerImpl.class \
    $(MIDP_MAKE_DIR)/classes/com/sun/j2me/content/RegistryImpl.class \
    $(MIDP_MAKE_DIR)/classes/com/sun/j2me/content/RequestListenerImpl.class \
    $(MIDP_MAKE_DIR)/classes/com/sun/j2me/content/ResponseListenerImpl.class \
    $(MIDP_MAKE_DIR)/classes/com/sun/j2me/content/InvocationImpl.class \
    $(MIDP_MAKE_DIR)/classes/com/sun/j2me/content/RegistryStore.class \
    $(MIDP_MAKE_DIR)/classes/com/sun/j2me/content/InvocationStore.class \
    $(MIDP_MAKE_DIR)/classes/com/sun/j2me/content/AppProxy.class 



$(INTERNAL_JSR_211_CLASS_FILES): $(MIDP_MAKE_DIR)/classes/%.class : \
                                 $(INTERNAL_JSR_211_DIR)/%.java $(INTERNAL_JSR_211_JUMP_DIR)/%.java
	@echo $< >> $(GENERATED_FILE_LIST)



# All of them together to provide to main makefile
#
SUBSYSTEM_JSR_211_CLASS_FILES = $(INTERNAL_JSR_211_CLASS_FILES) 
SUBSYSTEM_JSR_211_JAVA_FILES  = $(INTERNAL_JSR_211_JAVA_FILES) 

SUBSYSTEM_JSR211_CNI_CLASSES  = $(INTERNAL_JSR_211_DIR)/com/sun/j2me/content/RegistryStore.java

# Native files for the ( chapi ) subsystem
#

INTERNAL_JSR_211_NATIVE_FILES += \
	regstore.c jsr211_registry_impl.c

# Specify romizer configuration file for the jsr
# and path where the file is located
#
ROMGEN_INCLUDE_PATHS += $(JSR_211_DIR)/build/cldc_application
ROMGEN_CFG_FILES     += chapi_rom.cfg

############################################################
# Native files under JSR_211 subsystem
############################################################
SUBSYSTEM_JSR_211_NATIVE_FILES += \
    $(INTERNAL_JSR_211_NATIVE_FILES) \

# Append JSR_211 source bundle creation to target
source_bundle:: chapi_source_bundle

# Create JSR_211 source in subdir 'jsr211/'
JSR_211_SOURCE_OUTPUT_DIR=$(SOURCE_OUTPUT_DIR)/jsr211


# For MIDP stack, only include necessary source files
JSR_211_SOURCE_SUBDIRS = src/jump_application/classes \
			src/share/classes \
			src/jump_application/core \
			src/share/classes \
			build/jump_application \
			build/share 

# Copy and filter JSR_211 source in JSR_211_SOURCE_OUTPUT_DIR
chapi_source_bundle: JSR_211_DIR SOURCE_OUTPUT_DIR
	@echo " ... JSR 211 source bundle" $(LOG)
	@$(call re_src_filter,$(JSR_211_DIR),$(JSR_211_SOURCE_OUTPUT_DIR),\
	$(JSR_211_SOURCE_SUBDIRS))

##################################################################
# JUMP required variables
##################################################################

JSROP_CNI_CLASSES    += $(SUBSYSTEM_JSR211_CNI_CLASSES)

SUBSYSTEM_JSR_211_INCLUDE_DIRS += \
    $(JSROP_ABSTRACTS_DIR)/include \
    $(SUBSYSTEM_JSR_211_EXTRA_INCLUDES)

JSR_211_LIB_NAME        = jsr211
JSR_211_JAR             = $(JSROP_LIB_DIR)/$(JSR_211_LIB_NAME).jar
JSR_211_NATIVE_LIB      = $(JSROP_LIB_DIR)/$(LIB_PREFIX)$(JSR_211_LIB_NAME)$(LIB_POSTFIX)
JSR_211_NATIVE_OBJS     = $(patsubst %.c,$(JSROP_OBJ_DIR)/%.o,$(SUBSYSTEM_JSR_211_NATIVE_FILES))


JPP_DEFS             += -DENABLE_JSR_211
#EXTRA_CFLAGS         += -DENABLE_JSR_211=1
JSROP_NATIVE_OBJS    += $(JSR_211_NATIVE_OBJS)
JSROP_NATIVE_LIBS    += $(JSR_211_NATIVE_LIB)
JSROP_INCLUDE_DIRS   += $(JSROP_ABSTRACTS_DIR)/include \
                        $(SUBSYSTEM_JSR_211_EXTRA_INCLUDES)


CVM_INCLUDE_JAVACALL  = true

$(JSR_211_JAR):  $(SUBSYSTEM_JSR_211_JAVA_FILES) $(TOOLS)
	$(call compileJSRClasses,211)

$(JSR_211_NATIVE_OBJS): javacall_lib $(SUBSYSTEM_JSR_211_NATIVE_FILES)

$(JSR_211_NATIVE_LIB): $(JSR_211_NATIVE_OBJS) $(ABSTRACTIONS_NATIVE_LIBRARY)
	@echo "Linking $@"
	$(AT)$(call makeSharedLibrary, $(JSR_211_NATIVE_OBJS))	
	